- type: parallel
  steps:
    - name: tests
      service: bot-dev
      command: npm test

- type: serial
  steps:
    - name: dockerhub_push
      service: bot-prod
      type: push
      image_name: ftass/mister-t
      image_tag: "{{ .Branch }}-{{ .CommitID }}"
      registry: https://index.docker.io/v1/
      encrypted_dockercfg_path: dockercfg.encrypted
    - name: Push
      service: deployed
      type: push
      image_name: registry.heroku.com/mister-t
      image_tag: "{{ .Branch }}-{{ .CommitID }}"
      registry: registry.heroku.com
      dockercfg_service: dockercfg-generator